<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Курс: Делегування та постановка керівників | TALKO System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --primary-dark: #16a34a;
            --primary-darker: #15803d;
            --text-primary: #1a1a1a;
            --text-secondary: #525252;
            --text-muted: #6b7280;
            --bg-white: #ffffff;
            --bg-gray: #f9fafb;
            --bg-green-light: #f0fdf4;
            --border-gray: #e5e7eb;
            --red: #ef4444;
            --orange: #f59e0b;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --yellow: #fbbf24;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-gray);
        }

        /* Login */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 420px;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.25rem;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
        }

        .login-logo svg {
            width: 36px;
            height: 36px;
            color: white;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .form-label svg {
            width: 16px;
            height: 16px;
            color: var(--text-muted);
        }

        .form-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border-gray);
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--bg-gray);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: #ffffff;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(34, 197, 94, 0.35);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .login-btn svg {
            width: 20px;
            height: 20px;
        }

        .error-message {
            background: #fef2f2;
            color: var(--red);
            padding: 0.875rem 1rem;
            border-radius: 12px;
            font-size: 0.875rem;
            margin-top: 1rem;
            border: 1px solid #fecaca;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .error-message svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        /* Header */
        .header {
            background: var(--bg-white);
            border-bottom: 2px solid var(--border-gray);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1000px;
            margin: 0 auto;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.25);
        }

        .logo svg {
            width: 24px;
            height: 24px;
            color: white;
        }

        .header-title {
            font-size: 1.125rem;
            font-weight: 800;
            color: var(--text-primary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.875rem;
            color: var(--text-muted);
            background: var(--bg-gray);
            padding: 8px 16px;
            border-radius: 10px;
        }

        .user-info svg {
            width: 18px;
            height: 18px;
            color: var(--primary);
        }

        .logout-btn {
            background: none;
            border: 2px solid var(--border-gray);
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .logout-btn svg {
            width: 16px;
            height: 16px;
        }

        .logout-btn:hover {
            border-color: var(--red);
            color: var(--red);
            background: #fef2f2;
        }

        /* Main Container */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* Welcome Section */
        .welcome-section {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            border: 2px solid var(--border-gray);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .welcome-icon {
            width: 56px;
            height: 56px;
            background: var(--bg-green-light);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .welcome-icon svg {
            width: 28px;
            height: 28px;
            color: var(--primary);
        }

        .welcome-text h2 {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .welcome-text p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Course Structure Section */
        .course-structure {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            color: white;
        }

        .course-structure-header {
            display: flex;
            align-items: center;
            gap: 14px;
            margin-bottom: 24px;
        }

        .course-structure-header svg {
            width: 28px;
            height: 28px;
            color: var(--yellow);
        }

        .course-structure-header h2 {
            font-size: 1.25rem;
            font-weight: 800;
        }

        .structure-steps {
            display: grid;
            gap: 16px;
        }

        .structure-step {
            background: rgba(255,255,255,0.1);
            border-radius: 14px;
            padding: 18px 20px;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            position: relative;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .structure-step.current {
            background: rgba(34, 197, 94, 0.2);
            border-color: var(--primary);
        }

        .structure-step.current::before {
            content: '← ви тут';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
        }

        .step-number {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .structure-step.current .step-number {
            background: var(--primary);
        }

        .step-content h3 {
            font-size: 0.95rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .step-content p {
            font-size: 0.85rem;
            opacity: 0.85;
            line-height: 1.5;
        }

        .structure-note {
            margin-top: 20px;
            padding: 16px;
            background: rgba(251, 191, 36, 0.15);
            border-radius: 12px;
            border-left: 4px solid var(--yellow);
        }

        .structure-note p {
            font-size: 0.875rem;
            opacity: 0.95;
            line-height: 1.6;
        }

        .structure-note strong {
            color: var(--yellow);
        }

        /* AI Assistant Section */
        .ai-intro {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .ai-intro::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .ai-intro-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .ai-intro-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .ai-intro-icon {
            width: 64px;
            height: 64px;
            background: rgba(255,255,255,0.2);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .ai-intro-icon svg {
            width: 32px;
            height: 32px;
            color: white;
        }

        .ai-intro-text h2 {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .ai-intro-text p {
            opacity: 0.9;
            font-size: 0.95rem;
            max-width: 380px;
        }

        .ai-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #ffffff;
            color: var(--primary-dark) !important;
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.95rem;
            text-decoration: none;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .ai-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Recommendation tip */
        .ai-recommendation {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: flex-start;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .ai-recommendation svg {
            width: 20px;
            height: 20px;
            color: var(--yellow);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .ai-recommendation p {
            font-size: 0.875rem;
            opacity: 0.95;
            line-height: 1.5;
        }

        /* Course Meta */
        .course-meta {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            border: 2px solid var(--border-gray);
        }

        .course-meta h1 {
            font-size: 1.125rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .course-meta h1 .icon-wrapper {
            width: 40px;
            height: 40px;
            background: var(--bg-green-light);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .course-meta h1 svg {
            width: 22px;
            height: 22px;
            color: var(--primary);
        }

        .course-meta p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-section {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            border: 2px solid var(--border-gray);
        }

        .progress-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .progress-header svg {
            width: 22px;
            height: 22px;
            color: var(--primary);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex: 1;
        }

        .progress-text {
            font-weight: 700;
            color: var(--text-primary);
        }

        .progress-count {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .progress-track {
            height: 14px;
            background: var(--bg-gray);
            border-radius: 7px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 7px;
            transition: width 0.5s ease;
            width: 0%;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Materials List */
        .materials-section {
            background: var(--bg-white);
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            border: 2px solid var(--border-gray);
            overflow: hidden;
        }

        .materials-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px 25px;
            border-bottom: 2px solid var(--border-gray);
            background: var(--bg-gray);
        }

        .materials-header .icon-wrapper {
            width: 40px;
            height: 40px;
            background: var(--bg-white);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .materials-header svg {
            width: 22px;
            height: 22px;
            color: var(--primary);
        }

        .materials-header h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .materials-list {
            max-height: none;
        }

        .material-item {
            border-bottom: 1px solid var(--border-gray);
            transition: background 0.2s;
        }

        .material-item:last-child {
            border-bottom: none;
        }

        .material-item:hover {
            background: var(--bg-gray);
        }

        .material-item.completed {
            background: var(--bg-green-light);
        }

        .material-item.completed .material-title {
            text-decoration: line-through;
            color: #6b7280 !important;
        }

        .material-main {
            display: flex;
            align-items: flex-start;
            gap: 14px;
            padding: 16px 25px;
        }

        .material-number {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: var(--bg-gray);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted) !important;
        }

        .material-item.completed .material-number {
            background: var(--primary);
            color: #ffffff !important;
        }

        .checkbox-wrapper {
            flex-shrink: 0;
            position: relative;
        }

        .checkbox-wrapper input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            background: var(--bg-white);
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checkbox-wrapper:hover .checkmark {
            border-color: var(--primary);
            background: var(--bg-green-light);
        }

        .checkbox-wrapper input:checked ~ .checkmark {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkmark svg {
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 3;
            fill: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .checkbox-wrapper input:checked ~ .checkmark svg {
            opacity: 1;
        }

        .material-content {
            flex: 1;
            min-width: 0;
        }

        .material-title-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .material-type {
            flex-shrink: 0;
            width: 20px;
            height: 20px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .material-type svg {
            width: 12px;
            height: 12px;
        }

        .material-type.study {
            background: #dbeafe;
            color: var(--blue);
        }

        .material-type.task {
            background: #fef3c7;
            color: var(--orange);
        }

        .material-type.template {
            background: #ede9fe;
            color: var(--purple);
        }

        .material-type.ai {
            background: var(--bg-green-light);
            color: var(--primary);
        }

        .material-title {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a !important;
            line-height: 1.4;
        }

        .material-desc {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
            white-space: pre-wrap;
            line-height: 1.5;
        }

        .material-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--primary) !important;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }

        .material-link:hover {
            color: var(--primary-dark) !important;
            gap: 8px;
        }

        .material-link svg {
            width: 14px;
            height: 14px;
        }

        /* Notes Section */
        .material-notes {
            padding: 0 25px 16px 72px;
        }

        .notes-container {
            background: #fffbeb;
            border: 2px solid #fef3c7;
            border-radius: 12px;
            padding: 14px;
        }

        .notes-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .notes-header svg {
            width: 16px;
            height: 16px;
            color: var(--orange);
        }

        .notes-header span {
            font-size: 12px;
            font-weight: 600;
            color: var(--orange);
        }

        .notes-textarea {
            width: 100%;
            min-height: 70px;
            padding: 12px;
            border: 2px solid #fde68a;
            border-radius: 10px;
            font-size: 13px;
            font-family: inherit;
            line-height: 1.5;
            resize: vertical;
            background: white;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .notes-textarea::placeholder {
            color: #d4a574;
        }

        .notes-saved {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            font-size: 11px;
            color: var(--primary);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .notes-saved.show {
            opacity: 1;
        }

        .notes-saved svg {
            width: 14px;
            height: 14px;
        }

        /* Reset Button */
        .reset-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-white);
            border: 2px solid var(--border-gray);
            border-radius: 14px;
            font-family: inherit;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn svg {
            width: 18px;
            height: 18px;
        }

        .reset-btn:hover {
            border-color: var(--red);
            color: var(--red);
            background: #fef2f2;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 600px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .header-right {
                width: 100%;
                justify-content: space-between;
            }

            .ai-intro-main {
                flex-direction: column;
                text-align: center;
            }

            .ai-intro-content {
                flex-direction: column;
            }

            .welcome-section {
                flex-direction: column;
                text-align: center;
            }

            .material-main {
                padding: 14px 18px;
            }

            .material-notes {
                padding: 0 18px 14px 18px;
            }

            .material-number {
                width: 28px;
                height: 28px;
                font-size: 11px;
            }

            .material-title {
                font-size: 13px;
            }

            .user-info span {
                display: none;
            }

            .structure-step.current::before {
                position: static;
                transform: none;
                display: inline-block;
                margin-top: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <h1 class="login-title">Делегування та постановка керівників</h1>
                <p class="login-subtitle">Увійдіть до вашого акаунта</p>
            </div>
            
            <form id="login-form">
                <div class="form-group">
                    <label class="form-label" for="email">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="20" height="16" x="2" y="4" rx="2"/>
                            <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                        </svg>
                        Email
                    </label>
                    <input type="email" id="email" class="form-input" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="password">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                        Пароль
                    </label>
                    <input type="password" id="password" class="form-input" placeholder="••••••••" required>
                </div>
                
                <button type="submit" id="login-btn" class="login-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                        <polyline points="10 17 15 12 10 7"/>
                        <line x1="15" x2="3" y1="12" y2="12"/>
                    </svg>
                    Увійти
                </button>
                
                <div id="login-error" class="error-message hidden">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" x2="12" y1="8" y2="12"/>
                        <line x1="12" x2="12.01" y1="16" y2="16"/>
                    </svg>
                    <span id="error-text"></span>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <h1 class="header-title">Делегування та постановка керівників</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"/>
                            <circle cx="12" cy="10" r="3"/>
                            <path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/>
                        </svg>
                        <span id="user-email"></span>
                    </div>
                    <button id="logout-btn" class="logout-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" x2="9" y1="12" y2="12"/>
                        </svg>
                        Вихід
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="container">
            <!-- Welcome Section -->
            <div class="welcome-section">
                <div class="welcome-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/>
                        <circle cx="12" cy="13" r="3"/>
                    </svg>
                </div>
                <div class="welcome-text">
                    <h2 id="welcome-title">Вітаємо на курсі!</h2>
                    <p>Опрацьовуйте матеріали послідовно та робіть нотатки</p>
                </div>
            </div>

            <!-- Course Structure -->
            <div class="course-structure">
                <div class="course-structure-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" x2="8" y1="13" y2="13"/>
                        <line x1="16" x2="8" y1="17" y2="17"/>
                        <line x1="10" x2="8" y1="9" y2="9"/>
                    </svg>
                    <h2>СТРУКТУРА КУРСУ</h2>
                </div>
                
                <div class="structure-steps">
                    <div class="structure-step current">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3>Підготовка матеріалів</h3>
                            <p>Ви підготуєте тезиси, презентацію, перевірку і опитування. Це матеріали для загальної презентації оргсхеми команді, яку проведете В КІНЦІ курсу.</p>
                        </div>
                    </div>
                    
                    <div class="structure-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3>Технологія передачі функцій</h3>
                            <p>Ви вивчите, як правильно передавати функції — опис, передача, наставництво. Це ключова навичка.</p>
                        </div>
                    </div>
                    
                    <div class="structure-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3>Передача функцій відповідальним</h3>
                            <p>Ви передасте функції керівникам відділень за технологією.</p>
                        </div>
                    </div>
                    
                    <div class="structure-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3>Загальна презентація</h3>
                            <p>Коли функції передані — проводите загальну презентацію оргсхеми для всієї команди. Кожен співробітник презентує СВОЮ функцію на структурі.</p>
                        </div>
                    </div>
                </div>

                <div class="structure-note">
                    <p><strong>Чому саме така послідовність?</strong> Матеріали готуємо ЗАРАЗ, поки свіже розуміння оргсхеми. Але презентацію проводимо ПІСЛЯ передачі функцій — щоб кожен вже знав свою роль і міг її презентувати.</p>
                </div>
            </div>

            <!-- AI Assistant Intro -->
            <div class="ai-intro">
                <div class="ai-intro-main">
                    <div class="ai-intro-content">
                        <div class="ai-intro-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 8V4H8"/>
                                <rect width="16" height="12" x="4" y="8" rx="2"/>
                                <path d="M2 14h2"/>
                                <path d="M20 14h2"/>
                                <path d="M15 13v2"/>
                                <path d="M9 13v2"/>
                            </svg>
                        </div>
                        <div class="ai-intro-text">
                            <h2>AI-асистент модуля делегування</h2>
                            <p>Проведе вас через всі кроки, допоможе підготувати матеріали та відповість на питання</p>
                        </div>
                    </div>
                    <a href="https://chatgpt.com/g/g-6951729e72c881919e55005539b9277a-delegation-module-assistant-1" target="_blank" class="ai-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                        </svg>
                        Почати з AI-асистентом
                    </a>
                </div>
                <div class="ai-recommendation">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v4"/>
                        <path d="m6.343 7.757-2.828-2.829"/>
                        <path d="M2 13h4"/>
                        <path d="m6.343 18.243-2.828 2.829"/>
                        <path d="M12 18v4"/>
                        <path d="m17.657 18.243 2.828 2.829"/>
                        <path d="M18 13h4"/>
                        <path d="m17.657 7.757 2.828-2.829"/>
                        <circle cx="12" cy="13" r="3"/>
                    </svg>
                    <p><strong>Рекомендуємо:</strong> AI-асистент проведе вас через всю структуру курсу крок за кроком. Він пояснить логіку, допоможе підготувати матеріали та дасть зворотний зв'язок. Почніть з нього!</p>
                </div>
            </div>

            <!-- Course Meta -->
            <div class="course-meta">
                <h1>
                    <div class="icon-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                        </svg>
                    </div>
                    Модуль делегування та постановка керівників
                </h1>
                <p>МЕТА ПРОГРАМИ: У цьому курсі починається процес впровадження інструменту управління оргсхема. Для цього ви розробите регламент щодо використання оргсхеми та проведете ознайомлювальне заняття з оргсхеми. Узгоджуєте план передачі функцій з усіма залученими співробітниками в цей план.</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-section">
                <div class="progress-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                    <div class="progress-info">
                        <span class="progress-text">Прогрес курсу</span>
                        <span class="progress-count"><span id="completed-count">0</span> з <span id="total-count">47</span> завдань</span>
                    </div>
                </div>
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <!-- Materials List -->
            <div class="materials-section">
                <div class="materials-header">
                    <div class="icon-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/>
                        </svg>
                    </div>
                    <h3>Матеріали курсу</h3>
                </div>
                <div class="materials-list" id="materials-list"></div>
            </div>

            <button class="reset-btn" onclick="resetProgress()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                    <path d="M21 3v5h-5"/>
                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                    <path d="M8 16H3v5"/>
                </svg>
                Скинути прогрес
            </button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Config - delegation-2-1
        const firebaseConfig = {
            apiKey: "AIzaSyCc58Ek8zr6UDeeI-QQEsFb4IMOHk2otuE",
            authDomain: "delegation-2-1.firebaseapp.com",
            projectId: "delegation-2-1",
            storageBucket: "delegation-2-1.firebasestorage.app",
            messagingSenderId: "665888867368",
            appId: "1:665888867368:web:ef2fa52e8d9f0017d9211d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let userProgress = {};
        let userNotes = {};
        let saveTimeout = null;

        // Materials data (47 items - updated structure)
        const materials = [
            // КРОК 1: Підготовка матеріалів (уроки 1-3 замінено на AI-асистента)
            { id: 1, type: 'ai', title: "КРОК 1: Підготовка матеріалів з AI-асистентом", desc: "AI-асистент проведе вас через підготовку тезисів, презентації, перевірки та опитування. Це матеріали для загальної презентації оргсхеми команді, яку проведете В КІНЦІ курсу.\n\nПройдіть діалог з асистентом — він пояснить структуру курсу та допоможе підготувати всі необхідні матеріали.", url: "https://chatgpt.com/g/g-6951729e72c881919e55005539b9277a-delegation-module-assistant-1" },
            
            // КРОК 2: Технологія передачі функцій (починається з уроку 2)
            { id: 2, type: 'study', title: "Вивчіть ЯК ПЕРЕДАТИ ФУНКЦІЮ", url: "https://docs.google.com/document/d/1sW729Atft0NO54XtrYNzD-Q-_T-ZwCA4XhCl57Ed1Y4/edit?usp=sharing" },
            { id: 3, type: 'task', title: "МОЇ ПОМИЛКИ У ДЕЛЕГУВАННІ", desc: "Напишіть 5 помилок у делегуванні, які ви припускалися з перелічених в статті. Опишіть конкретні ситуації:\n\n1.\n2.\n3.\n4.\n5." },
            { id: 4, type: 'ai', title: "КРОК 2: Регламент щодо використання оргсхеми", desc: "AI-асистент допоможе вам:\n• Вивчити практичне завдання з регламенту\n• Доопрацювати шаблон регламенту під вашу компанію\n• Уникнути поширених помилок при роботі з регламентом\n\nПройдіть діалог з асистентом — він проведе вас через весь процес створення регламенту.", url: "https://chatgpt.com/g/g-695178a73c5881918fdccafddb601baa-delegation-module-assistant-2" },
            { id: 5, type: 'study', title: "Вивчіть Стаття. Прояснення продукту та функцій посади", url: "https://docs.google.com/document/d/16zIvZ2hH-MKjfWGT5rt-I816Kv1y49I-eC2YFQTAtko/edit?usp=sharing" },
            { id: 6, type: 'study', title: "Вивчіть ІНСТРУКЦІЯ З ПРОЯСНЕННЯ ПРОДУКТУ ТА ФУНКЦІЙ", url: "https://docs.google.com/document/d/1YLhZasASz7-LKgACA4BX2sxfJLLpi15ZifDzV9tpH0w/edit?usp=sharing" },
            { id: 7, type: 'study', title: "Вивчіть 2.2.2. Послідовність дій під час делегування функцій", url: "https://docs.google.com/document/d/176VUZTOzkCI7hKARX_oFShAdmurAspm9V34HEnNxYZM/edit?usp=sharing" },
            { id: 8, type: 'task', title: "ПЕРЕГЛЯНЬТЕ ФУНКЦІЇ ДЛЯ ДЕЛЕГУВАННЯ", desc: "Подивіться опис посади та напишіть нижче, які обов'язки вам потрібно делегувати в рамках діяльності відділення:\n\nКВ 1:\nКВ 2:\nКВ 3:\nКВ 4:\nКВ 5:\nКВ 6:" },
            { id: 9, type: 'study', title: "Вивчіть ПРОГРАМА ДЕЛЕГУВАННЯ ФУНКЦІЇ.docx", url: "https://docs.google.com/document/d/1nc5ZA5bEtOGoDZhKdWDBuMCrLa3CUuW-/edit?usp=sharing" },
            { id: 10, type: 'study', title: "Вивчіть Стаття. Як скласти опис функції та почати делегувати", url: "https://docs.google.com/document/d/1khcLHiG8oSFvJ3cse2Jr-u0hiASoXSdSIUU29CIliXM/edit?usp=sharing" },
            { id: 11, type: 'task', title: "ЗАГАЛЬНИЙ ОПИС РОБОТИ КОЖНОГО КЕРІВНИКА", desc: "Опишіть Ціль, ЦКП та основні обов'язки, які стосуються роботи кожного керівника. Додайте до цього опису типові помилки та успішні дії зі свого досвіду керівника." },
            { id: 12, type: 'template', title: "AI-асистент для розробки опису функції", desc: "Використовуйте AI-асистента для створення детального опису функції. Він допоможе структурувати інформацію та сформулювати всі необхідні елементи опису.", url: "https://chatgpt.com/g/g-684c0092653c81919f42552c12434fa7-function-description-generator" },
            { id: 13, type: 'task', title: "Прикріпіть опис для трьох функцій", desc: "Прикріпіть посилання на готові описи для трьох функцій, які ви створили за допомогою AI-асистента." },
            { id: 14, type: 'study', title: "Вивчіть 2.2.4. Як сформувати посадову папку для делегування", url: "https://docs.google.com/document/d/1hF_BuNavI0UtZ8-QkSJUvb7LIicgZprZOHdjEWTX9k8/edit?usp=sharing" },
            { id: 15, type: 'task', title: "Що має входити до посадової папки?", desc: "Напишіть, що має входити до посадової папки співробітника?" },
            { id: 16, type: 'study', title: "Структура посадової папки", desc: "У папці посади зберігаються документи:\n1. Опис посади (назва, ціль, продукт, положення на оргсхемі, обов'язки, статистики)\n2. Повна добірка письмових матеріалів (інструкцій, політик, статей, посібників)\n3. Контрольний лист для вивчення всіх матеріалів" },
            { id: 17, type: 'task', title: "ПАПКА ДЛЯ КЕРІВНИКА ВІДДІЛЕННЯ", desc: "Створіть папку для керівника відділення в електронному та/або друкованому вигляді. Помістіть до папки як мінімум опис посади, який склали раніше." },
            { id: 18, type: 'task', title: "Завантажте папки керівників", desc: "Вставте посилання на папку з необхідними документами:\n- Фото папки КВ1\n- Фото папки КВ2\n- Фото папки КВ3\n- Фото папки КВ4\n- Фото папки КВ5\n- Фото папки КВ6" },
            { id: 19, type: 'study', title: "Вивчіть ІНСТРУКЦІЯ З ПРОЯСНЕННЯ ПОСАДОВИХ ОБОВ'ЯЗКІВ.docx", url: "https://docs.google.com/document/d/108mKsOoLq2W72E7vstIxqkIBncm5OWxu/edit?usp=sharing" },
            { id: 20, type: 'study', title: "Вивчіть Стаття. Секрет обміну. Чому клієнти йдуть, а бізнес прогоряє", url: "https://docs.google.com/document/d/19hUlK6UuF-UBeSiKNA6nJrJtwbg3dQiRl8KCZsZLM_w/edit?usp=sharing" },
            { id: 21, type: 'study', title: "Вивчіть 2.2.5. Тренування Прояснення продукту та функцій посади", url: "https://docs.google.com/document/d/12m-ujCkXIEy6_jscygPp_Pv69W-8_OAEvcy7xDdEe50/edit?usp=sharing" },
            { id: 22, type: 'task', title: "Яка різниця між керівником та тренером?" },
            { id: 23, type: 'task', title: "Чому співробітник повинен отримувати перемоги?" },
            { id: 24, type: 'task', title: "Чому співробітник має наводити багато прикладів при проясненні продукта?" },
            { id: 25, type: 'task', title: "Що ви вважаєте найкориснішим у цій процедурі?" },
            { id: 26, type: 'study', title: "Вивчіть 2.2.6. ПРАКТИЧНЕ ЗАВДАННЯ. ППФ та план роботи на два тижні", url: "https://docs.google.com/document/d/1CJIu1i4e8XBcqY3zTmvlWmMkynylXlhupxsnEXm0sps/edit?usp=sharing" },
            { id: 27, type: 'study', title: "Поширені помилки при ППФ", desc: "1. Не дотримання сценарію інструкції\n2. Пропуск хоча б одного пункта\n3. Не перевірка розуміння співробітника\n4. Співробітник не сам читає опис функції\n5. Не проговорити базові поняття: ЦКП, мета, обмін\n6. Давати відповіді замість питань\n7. Бути керівником замість тренера\n8. Поспішати з відповідями\n9. Не проговорити план дій в кінці\n10. Копіювати план без адаптації\n11. Занадто маленький план роботи\n12. Занадто великий список завдань\n13. Список завдань не спрямований на постановку на пост" },
            
            // КРОК 3: Передача функцій відповідальним
            { id: 28, type: 'task', title: "ПРОВЕДІТЬ ПЕРШЕ ППФ ДЛЯ КОЖНОГО КЕРІВНИКА", desc: "Створіть розклад у Google календарі, за яким проводитимете прояснення продукту та функцій майбутнім керівникам. Записуйте всі процедури." },
            { id: 29, type: 'task', title: "Плани на два тижні", desc: "Складіть план на два тижні для функції, яку делегуєте. Опишіть конкретні кроки, завдання та очікувані результати для кожного майбутнього керівника." },
            { id: 30, type: 'study', title: "Вивчіть Як діяти на новій посаді.docx", url: "https://docs.google.com/document/d/1MG3vJwdYGvxZKPB4EIfUSYgGw1NsMztv/edit?usp=sharing" },
            { id: 31, type: 'study', title: "Вивчіть ІНСТРУКЦІЯ Друга співбесіда з майбутніми керівниками.docx", url: "https://docs.google.com/document/d/1z8WK7G1X6BlVP4_DOqXg-SyctzLklkRF/edit?usp=sharing" },
            { id: 32, type: 'study', title: "РЕКОМЕНДАЦІЇ проведення СПІВБЕСІДИ", desc: "1. Не відволікайтеся на питання, що не належать до теми\n2. Рухайтеся за планом співбесіди\n3. Зберігайте гарний настрій та прийнятний емоційний тон" },
            { id: 33, type: 'study', title: "Поширені помилки при ППФ з керівниками", desc: "1. Резидент не проводить ППФ, якщо всі керівники давно працюють\n2. Резидент не промовляє терміни (ЦКП, ціль, командні лінії)\n3. ППФ перетворюється на розбір польотів\n4. Не давати зворотний зв'язок\n5. Не передати посадову папку\n6. Забути про план на 2 місяці\n7. Не отримати відповідь на запитання про сумніви\n8. Не обговорити вступ на посаду\n9. Не дати підтвердження чому він впорається\n10. Не отримати підтвердження готовності" },
            { id: 34, type: 'study', title: "Підготовча сесія для передачі функцій", desc: "Наступні уроки будуть присвячено делегуванню усіх функцій. Рекомендую проводити сесію в суботу.", url: "https://docs.google.com/document/d/14T1EuoTrQqMGV8A6ER1LAsMikUb2Fhf0/edit?usp=sharing" },
            { id: 35, type: 'task', title: "Перевірка регламенту КВ1", desc: "Якщо ви давали вашому КВ 1 завдання з доопрацювання регламенту з оргсхеми, перевірте їх згідно з ІНСТРУКЦІЯ Як перевірити регламент щодо використання оргсхеми.docx" },
            { id: 36, type: 'study', title: "Вивчіть 2.1.4. ПРАКТИЧНЕ ЗАВДАННЯ. Підготуватися до навчального заняття", desc: "Важливо не говорити, що ми робимо, бо так сказав Талько. Ви повинні сказати, що ми це робимо так, тому що я вважаю, що це оптимально.", url: "https://docs.google.com/document/d/1ctqasPAvy_f_JjHsqrd057V0DDIE0Cu4BkJGVK5ZPMQ/edit?usp=sharing" },
            { id: 37, type: 'task', title: "Тези та презентація для заняття", desc: "Заповніть тези до своїх прикладів. Підготуйте слайди для заняття." },
            { id: 38, type: 'task', title: "Посилання на презентацію та тезиси" },
            { id: 39, type: 'study', title: "Вивчіть 2.2.9. ЗАВДАННЯ. Підготувати наказ про заповнення функцій", url: "https://docs.google.com/document/d/1yvx_EG3KJw3qGbv_jAYOclHNRAwB40B5/edit?usp=sharing" },
            { id: 40, type: 'task', title: "НАКАЗ ПРО РОЗПОДІЛ ФУНКЦІЙ", desc: "Створіть свій наказ про розподіл функцій між співробітниками та опублікуйте його перед загальним зборами персоналу.\n\nЗавантажте свій варіант наказу.\nЯкі ідеї прийшли вам у процесі виконання цього завдання?" },
            { id: 41, type: 'task', title: "Додатки до наказу" },
            
            // КРОК 4: Загальна презентація
            { id: 42, type: 'study', title: "Вивчіть 2.2.10. ПРАКТИЧНЕ ЗАВДАННЯ. Проведіть загальні збори персоналу", url: "https://docs.google.com/document/d/1RRPFHx8qQbjc_zWMPDM-_KDaCniNEJ9n/edit?usp=sharing" },
            { id: 43, type: 'study', title: "Вивчіть ІНСТРУКЦІЯ ЯК ПРОВОДИТИ ЗАГАЛЬНІ ЗБОРИ З ОРГСХЕМИ", url: "https://docs.google.com/document/d/1J7IqVY1n0xMRXnV1t66bKP51GWRrI3PEWXgwVaP_JmE/edit?usp=sharing" },
            { id: 44, type: 'task', title: "Тренування загальних зборів перед дзеркалом" },
            { id: 45, type: 'task', title: "ПРОВЕДІТЬ ЗАГАЛЬНІ ЗБОРИ ПЕРСОНАЛУ", desc: "Проведіть його весело та невимушено, запально та динамічно.\n\nЗробіть запис зборів та прикріпіть посилання.\nНапишіть свої висновки.\n\nЗверніть увагу, що керівники відділень в кінці мають вийти і коротко розповісти про своє відділення." },
            { id: 46, type: 'study', title: "Вивчіть 2.2.11. Введення функції відповідального за підтримку оргсхеми", url: "https://docs.google.com/document/d/1dgVcuVuTeXLhtjq2vPgyFQ1Ywt_KFsonjZ0ZeLfv0cM/edit?usp=sharing" },
            { id: 47, type: 'task', title: "ВІДПОВІДАЛЬНИЙ ЗА ОРГСХЕМУ", desc: "Хто зараз у вашій компанії відповідатиме за організуючу схему?\nЩо нового ви собі дізналися?\nЯкі висновки ви зробили?" }
        ];

        // Type icons
        const typeIcons = {
            study: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>`,
            task: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>`,
            template: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><path d="M12 18v-6"/><path d="m9 15 3 3 3-3"/></svg>`,
            ai: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>`
        };

        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            loadUserProgress();
        }

        // Auth state observer
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('user-email').textContent = user.email;
                const firstName = user.email.split('@')[0];
                document.getElementById('welcome-title').textContent = `Вітаємо, ${firstName}!`;
                await loadUserProgress();
                showMainApp();
            } else {
                currentUser = null;
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        // Login form
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('login-btn');
            const errorDiv = document.getElementById('login-error');
            const errorText = document.getElementById('error-text');
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = `<span class="loading"></span>Вхід...`;
            errorDiv.classList.add('hidden');
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                let errorMessage = 'Помилка входу. Спробуйте ще раз';
                if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    errorMessage = 'Неправильний email або пароль';
                }
                if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Неправильний формат email';
                }
                errorText.textContent = errorMessage;
                errorDiv.classList.remove('hidden');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>Увійти`;
            }
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => signOut(auth));

        // Load progress
        async function loadUserProgress() {
            if (!currentUser) return;
            
            try {
                const userDocRef = doc(db, 'users', currentUser.uid);
                const userDoc = await getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    const data = userDoc.data();
                    userProgress = data.courseProgress || {};
                    userNotes = data.courseNotes || {};
                } else {
                    userProgress = {};
                    userNotes = {};
                    await setDoc(userDocRef, {
                        email: currentUser.email,
                        createdAt: serverTimestamp(),
                        courseProgress: userProgress,
                        courseNotes: userNotes
                    });
                }
            } catch (error) {
                console.error('Error loading progress:', error);
                userProgress = {};
                userNotes = {};
            }
            
            renderMaterials();
            updateProgress();
        }

        // Save progress
        async function saveUserProgress() {
            if (!currentUser) return;
            
            try {
                const userDocRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    courseProgress: userProgress,
                    lastUpdated: serverTimestamp()
                });
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        // Save notes with debounce
        async function saveUserNotes(index) {
            if (!currentUser) return;
            
            try {
                const userDocRef = doc(db, 'users', currentUser.uid);
                await updateDoc(userDocRef, {
                    courseNotes: userNotes,
                    lastUpdated: serverTimestamp()
                });
                
                // Show saved indicator
                const savedIndicator = document.getElementById(`notes-saved-${index}`);
                if (savedIndicator) {
                    savedIndicator.classList.add('show');
                    setTimeout(() => {
                        savedIndicator.classList.remove('show');
                    }, 2000);
                }
            } catch (error) {
                console.error('Error saving notes:', error);
            }
        }

        // Handle note change
        window.handleNoteChange = function(index, value) {
            userNotes[index] = value;
            
            // Debounce save
            if (saveTimeout) {
                clearTimeout(saveTimeout);
            }
            saveTimeout = setTimeout(() => {
                saveUserNotes(index);
            }, 1000);
        }

        // Toggle complete
        window.toggleComplete = async function(index) {
            userProgress[index] = !userProgress[index];
            await saveUserProgress();
            
            const item = document.querySelector(`[data-index="${index}"]`);
            if (userProgress[index]) {
                item.classList.add('completed');
            } else {
                item.classList.remove('completed');
            }
            
            updateProgress();
        }

        // Reset progress
        window.resetProgress = async function() {
            if (confirm('Ви впевнені, що хочете скинути весь прогрес? Нотатки залишаться.')) {
                userProgress = {};
                await saveUserProgress();
                renderMaterials();
                updateProgress();
            }
        }

        // Render materials
        function renderMaterials() {
            const container = document.getElementById('materials-list');
            
            container.innerHTML = materials.map((item, index) => `
                <div class="material-item ${userProgress[index] ? 'completed' : ''}" data-index="${index}">
                    <div class="material-main">
                        <div class="material-number">${item.id}</div>
                        <label class="checkbox-wrapper">
                            <input type="checkbox" ${userProgress[index] ? 'checked' : ''} onchange="toggleComplete(${index})">
                            <span class="checkmark">
                                <svg viewBox="0 0 24 24">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </span>
                        </label>
                        <div class="material-content">
                            <div class="material-title-row">
                                <div class="material-type ${item.type}">${typeIcons[item.type]}</div>
                                <div class="material-title">${item.title}</div>
                            </div>
                            ${item.desc ? `<div class="material-desc">${item.desc}</div>` : ''}
                            ${item.url ? `
                            <a href="${item.url}" target="_blank" class="material-link">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/>
                                    <polyline points="15 3 21 3 21 9"/>
                                    <line x1="10" x2="21" y1="14" y2="3"/>
                                </svg>
                                ${item.type === 'ai' ? 'Відкрити AI-асистента' : 'Відкрити матеріал'}
                            </a>
                            ` : ''}
                        </div>
                    </div>
                    <div class="material-notes">
                        <div class="notes-container">
                            <div class="notes-header">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 20h9"/>
                                    <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>
                                </svg>
                                <span>Мої нотатки</span>
                            </div>
                            <textarea 
                                class="notes-textarea" 
                                placeholder="Запишіть ключові думки, ідеї для впровадження..."
                                oninput="handleNoteChange(${index}, this.value)"
                            >${userNotes[index] || ''}</textarea>
                            <div class="notes-saved" id="notes-saved-${index}">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    <polyline points="22 4 12 14.01 9 11.01"/>
                                </svg>
                                Збережено
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('total-count').textContent = materials.length;
        }

        // Update progress bar
        function updateProgress() {
            const completed = Object.values(userProgress).filter(v => v).length;
            const total = materials.length;
            const percentage = Math.round((completed / total) * 100);
            
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-fill').style.width = percentage + '%';
        }
    </script>
</body>
</html>
